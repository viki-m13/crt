<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <title>CRT Recovery Predictor</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="masthead">
    <div class="wrap">
      <div class="brand">
        <h1>Stock Recovery Predictor</h1>
        <p class="subhead">Find undervalued S&P 500 stocks with early recovery signals that historically beat SPY</p>
        <div class="meta">Updated <span id="asOf">—</span></div>
      </div>

      <div class="signal-summary" id="signalSummary">
        <div class="signal-box signal-strong clickable active" data-signal="STRONG_BUY">
          <div class="signal-count" id="countStrong">-</div>
          <div class="signal-label">Strong Buy</div>
        </div>
        <div class="signal-box signal-buy clickable active" data-signal="BUY">
          <div class="signal-count" id="countBuy">-</div>
          <div class="signal-label">Buy</div>
        </div>
        <div class="signal-box signal-watch clickable active" data-signal="WATCH">
          <div class="signal-count" id="countWatch">-</div>
          <div class="signal-label">Watch</div>
        </div>
        <div class="signal-box signal-all clickable" data-signal="ALL">
          <div class="signal-count" id="countAll">-</div>
          <div class="signal-label">All</div>
        </div>
      </div>

      <details class="how-it-works">
        <summary>How It Works & Scoring Methodology</summary>
        <div class="how-content">
          <div class="how-grid">
            <div>
              <h3>The Strategy</h3>
              <p>Find quality stocks trading 10-50% below their 52-week high with signs of recovery. Historical pattern matching estimates probability of positive returns and beating SPY.</p>

              <h3>Score Components (0-100)</h3>
              <ul>
                <li><strong>Discount (up to 35 pts)</strong> — 1 point per 1% below 52W high</li>
                <li><strong>Beat SPY 1Y (up to 20 pts)</strong> — Historical probability of outperforming</li>
                <li><strong>Beat SPY 3Y (up to 15 pts)</strong> — Longer-term outperformance</li>
                <li><strong>Prob Positive 5Y (up to 15 pts)</strong> — Reliability indicator</li>
                <li><strong>Quality (up to 15 pts)</strong> — 5Y return > 0, consistent wins</li>
              </ul>
            </div>
            <div>
              <h3>Signal Thresholds</h3>
              <ul>
                <li><strong>STRONG BUY</strong> — Score ≥70, Beat SPY 1Y ≥55%, showing recovery</li>
                <li><strong>BUY</strong> — Score ≥55, Prob Positive 1Y ≥60%</li>
                <li><strong>WATCH</strong> — Score ≥40 (value exists but missing catalysts)</li>
              </ul>

              <h3>Why High 5Y Prob ≠ High Score</h3>
              <p>A stock with 100% probability of being positive in 5 years is reliable, but the key question is: <em>will it beat SPY?</em> A defensive stock may always be positive but underperform in bull markets. The score weights <strong>outperformance potential</strong> over mere positive returns.</p>
            </div>
            <div>
              <h3>Chart Zones (Discount from High)</h3>
              <ul>
                <li><span class="leg-deep"></span> <strong>30%+ off</strong> — Deep discount territory</li>
                <li><span class="leg-mod"></span> <strong>20-30% off</strong> — Moderate discount</li>
                <li><span class="leg-light"></span> <strong>10-20% off</strong> — Light discount</li>
              </ul>
              <p class="note">Chart zones show historical discount levels, not buy signals. A stock can be deeply discounted but still have a low signal if it lacks recovery catalysts or has poor probability of beating SPY.</p>
            </div>
          </div>
          <p class="disclaimer">Historical patterns. Not investment advice. Past performance does not guarantee future results.</p>
        </div>
      </details>

      <div class="controls">
        <div class="search-box">
          <input type="text" id="q" placeholder="Search ticker..." />
          <button id="go">Go</button>
        </div>
        <div class="sort-box">
          <label>Sort</label>
          <select id="sortSelect">
            <option value="score">Score</option>
            <option value="discount">Discount %</option>
            <option value="beatspy1y">Beat SPY 1Y</option>
            <option value="prob5y">Prob + 5Y</option>
            <option value="median1y">Median 1Y</option>
            <option value="median5y">Median 5Y</option>
            <option value="samples">Samples</option>
            <option value="ticker">Ticker</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="table-header">
      <span>Opportunities <span id="filteredCount"></span></span>
      <span class="hint">Click row to expand</span>
    </div>
    <div class="table-container">
      <table class="tbl">
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Signal</th>
            <th class="num">Score</th>
            <th class="num">Discount</th>
            <th class="num">Beat SPY 1Y</th>
            <th class="num">Med 1Y</th>
            <th class="num">Prob + 5Y</th>
            <th class="num">Med 5Y</th>
            <th class="num">Samples</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </main>

  <script src="app.js"></script>
</body>
</html>
